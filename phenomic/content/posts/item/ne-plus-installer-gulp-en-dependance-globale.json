{"filename":"index.md","title":"Ne plus installer gulp en dépendance globale","date":"2015-03-01","body":{"t":"div","c":[{"t":"p","c":["Avec l’arrivée de Gulp 4 (actuellement 3.8.x), qui apporte des nouveautés et\ncassera potentiellement la compatibilité descendante (nouvelle version\nmajeure), je me suis penché sur le problème que pose le fait d’utiliser Gulp\nvia une installation locale (projet, gulpfile.js) + une installation globale\n(système, commande gulp)."]},"\n",{"t":"p","c":[{"t":"span","p":{"class":"more"}}]},"\n",{"t":"p","c":["Si j’utilise Gulp 4 pour mes nouveaux projets pour profiter des nouveautés,\nalors je devrais mettre à jour mon installation globale. Sauf que par\nconséquent je risque de ne plus pouvoir l’utiliser sur mes projets anciens et\nactuels car ceux-ci seront toujours en 3.8.x. Je pourrais mettre à jour le gulp\nlocal à tous ces projets, mais ce serait galère. La meilleure solution serait\nd’avoir tout le temps la version globale de gulp correspondant à la version\nlocale du projet sur lequel je bosse."]},"\n",{"t":"p","c":["Il est très simple de régler ce problème sur les systèmes Linux / UNIX. Il\nsuffit de créer un alias sur ",{"t":"code","c":["./node_modules/.bin/gulp"]},"."]},"\n",{"t":"p","c":["Du côté de Windows, il va falloir ruser. Mais ça tombe bien, quand on installe\nlocalement un module qui a besoin d’une interface en ligne de commande, npm\ncrée un dossier ",{"t":"code","c":[".bin"]}," dans le dossier ",{"t":"code","c":["node_modules"]}," et il met les exécutables\ncorrespondant dedans. On a donc accès à la commande ",{"t":"code","c":["gulp"]}," sans l’installer en\nglobal."]},"\n",{"t":"p","c":["Pour lancer la tâche watch d’un projet, on peut faire ceci :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":[".\\node_modules.bin\\gulp watch"]}]}]}]},"\n",{"t":"p","c":["On peut aussi aller “plus loin” et utiliser les scripts NPM. NPM permet de\ndéfinir des scripts qui peuvent être lancés en tapant :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run nom_du_script"]}]}]}]},"\n",{"t":"p","c":["Pour définir un script, il suffit d’ajouter un objet “scripts” dans le\npackage.json. On peut donc faire ceci :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["\"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp\": \"./node_modules/.bin/gulp\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["Dans l’état c’est cool mais ça ne fait rien, il faudrait pouvoir lui passer la\ntâche qu’on veut exécuter en argument, ou alors définir un script par tâche :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["\"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:watch\": \"./node_modules/.bin/gulp watch\","]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:compile\": \"./node_modules/.bin/gulp compile\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    // autres tâches…"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["On pourrait donc faire :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run gulp:watch"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run gulp:compile"]}]}]}]},"\n",{"t":"p","c":["Mais le mieux serait de pouvoir utiliser le script ",{"t":"code","c":["gulp"]}," précédemment défini\net lui passer en paramètre le nom de la tâche qu’on veut exécuter. C’est\npossible de faire ça, mais uniquement à partir de la version 2.0.0 de npm. Il\nfaut donc mettre à jour notre npm si on est en 1.x.y (",{"t":"code","c":["npm -v"]}," pour vérifier) :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm install npm -g"]}]}]}]},"\n",{"t":"p","c":["On peut maintenant faire ceci :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run nom_du_script — arg1 arg2 \"arg avec des espaces\""]}]}]}]},"\n",{"t":"p","c":["Et du coup on peut lancer une tâche gulp en spécifiant son nom comme ceci :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run gulp -- watch"]}]}]}]},"\n",{"t":"p","c":["Et si on tient absolument à avoir un script pour chaque tâche, on peut\nréutiliser le script “gulp” déjà écrit :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["\"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp\": \"./node_modules/.bin/gulp\","]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:watch\": \"npm run gulp — watch\","]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:compile\": \"npm run gulp — compile\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    // autres tâches…"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["Oh, wait ! Il y a encore plus fort. Quand on lance un script avec ",{"t":"code","c":["npm run"]},",\nnpm prend le dossier ",{"t":"code","c":["node_modules/.bin"]}," et le met dans le PATH. On peut donc\nfaire encore plus court :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["\"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:watch\": \"gulp watch\","]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"gulp:compile\": \"gulp compile\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    // autres tâches…"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["Voilà, de cette manière, on évite d’avoir une installation globale de gulp (et\ndonc d’avoir à la maintenir à jour), et on a l’avantage de ne pas avoir à se\nsoucier de la version de gulp utilisée pour chacun des projets. Ceci est bien\nentendu (théoriquement) valable pour toutes les dépendances globales."]},"\n",{"t":"p","c":["Il est aussi interressant de voir qu'avec ce systèmes de scripts npm, l'interêt\ndes outils comme Gulp ou Grunt (pour ne citer qu'eux) devient limité. Des\narticles traitent très bien de ces sujets. Vous pouvez par exemple aller voir\n",{"t":"a","p":{"href":"http://blog.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/"},"c":["celui-ci"]}," de\nKeith Cirkel. Chacun se fera son propre avis !"]}]}}
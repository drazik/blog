{"filename":"index.md","title":"Utiliser webpack-bundle-analyzer avec create-react-app","date":"2018-12-24","timeSensitive":true,"body":{"t":"div","c":[{"t":"p","c":["La méthode préconisée par la documentation de create-react-app pour analyser la\ntaille de son bundle est d'utiliser\n",{"t":"a","p":{"href":"https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size"},"c":["source-map-explorer"]},".\nAprès avoir essayé cet outil, il s'avère qu'il est tout de même moins agréable\nà utiliser que\n",{"t":"a","p":{"href":"https://github.com/webpack-contrib/webpack-bundle-analyzer"},"c":["webpack-bundle-analyzer"]},".\nMais celui-ci s'utilise comme un plugin webpack, il faut donc utiliser la\nfonction\n",{"t":"a","p":{"href":"https://facebook.github.io/create-react-app/docs/available-scripts#npm-run-eject"},"c":[{"t":"code","c":["eject"]}]},"\nde create-react-app pour pouvoir l'utiliser. Toutefois, ejecter ou forker\nreact-scripts pour simplement ajouter ce plugin serait dommage... Heureusement,\nil est possible de l'utiliser sans ejecter, bien que ça ne soit pas vraiment\ndocumenté."]},"\n",{"t":"p","c":["La première étape est évidemment d'installer webpack-bundle-analyzer :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm install --save-dev webpack-bundle-analyzer"]}]}]}]},"\n",{"t":"p","c":["Ensuite, on va modifier le script ",{"t":"code","c":["build"]}," pour que celui-ci génère un fichier\nde statistiques qui pourra ensuite être consommé par webpack-bundle-analyzer :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["{"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["  \"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"build\": \"react-scripts build --stats\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["  }"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["L'option ",{"t":"code","c":["--stats"]}," aura pour effet de générer le fichier ",{"t":"code","c":["bundle-stats.json"]},"\ndans le dossier ",{"t":"code","c":["build"]}," lors de la génération du bundle. Cette option n'est pas\ndocumentée, mais on peut voir son effet dans les sources du script build :\n",{"t":"a","p":{"href":"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/scripts/build.js#L65"},"c":["ici"]},"\net\n",{"t":"a","p":{"href":"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/scripts/build.js#L191-L196"},"c":["là"]},"."]},"\n",{"t":"p","c":["Il ne nous reste plus qu'à lancer webpack-bundle-analyzer en lui passant ce\nfichier en entrée :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["{"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["  \"scripts\": {"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["    \"analyze\": \"webpack-bundle-analyzer build/bundle-stats.json\""]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["  }"]}]}]},{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["}"]}]}]}]},"\n",{"t":"p","c":["Et lancer ce script ",{"t":"code","c":["analyze"]},", après avoir fait un build :"]},"\n",{"t":"pre","p":{"class":"editor editor-colors"},"c":[{"t":"div","p":{"class":"line"},"c":[{"t":"span","p":{"class":"syntax--text syntax--plain syntax--null-grammar"},"c":[{"t":"span","c":["npm run build && npm run analyze"]}]}]}]},"\n",{"t":"p","c":["Et voilà :)"]}]}}